from datetime import datetime, timedelta, timezone
import requests
from bs4 import BeautifulSoup
import time
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from secrets import from_addr, password, to_addr


import requests

cookies = {
    '_ga': 'GA1.1.659034504.1679021907',
    '_ga_XF6JJFCG0V': 'GS1.1.1701231077.45.0.1701231077.60.0.0',
    '_ga_11FWXNQWRT': 'GS1.2.1701224936.95.0.1701224936.0.0.0',
    '_ga_L93HX51KWR': 'GS1.1.1691285542.128.0.1691285542.60.0.0',
    '_ga_WM9PTGSQNW': 'GS1.1.1691981276.28.0.1691981276.60.0.0',
    '_ga_Y29PC3P5S9': 'GS1.1.1691981276.27.0.1691981276.60.0.0',
    '__gads': 'ID=4dda9eefa93f9b91:T=1683050446:RT=1691978228:S=ALNI_MYVwTBT8Wq1BhHbPLsvAmjOMHV8jg',
    '__gpi': 'UID=000009852498e8bb:T=1683050446:RT=1691978228:S=ALNI_MbHMRyOHzBJt0zBfeoXa41LdVpUnQ',
    '_ga_W3BFRPSG9B': 'GS1.1.1684554989.1.0.1684554991.58.0.0',
    '_uetvid': 'e83b8c202f8d11eda3327765fc6f1aa8',
    '_ga_KWXJM9SF1E': 'GS1.1.1684554990.1.0.1684554990.0.0.0',
    'AMP_49f7a68a85': 'JTdCJTIyZGV2aWNlSWQlMjIlM0ElMjJiOTlmNjBjYS1iYjgwLTQ1NDktOTZmMS1jZTExZmY5MzAzYTclMjIlMkMlMjJ1c2VySWQlMjIlM0ElMjI1M2U1YWM4My1lODc5LTQ0OTAtYTZhOC0yMTExODkwZTM2OGIlMjIlMkMlMjJzZXNzaW9uSWQlMjIlM0ExNjg3MjA1NzY1NTA3JTJDJTIyb3B0T3V0JTIyJTNBZmFsc2UlMkMlMjJsYXN0RXZlbnRUaW1lJTIyJTNBMTY4NzIwNTc2OTk0NiUyQyUyMmxhc3RFdmVudElkJTIyJTNBMzElN0Q=',
    'AMP_MKTG_49f7a68a85': 'JTdCJTIycmVmZXJyZXIlMjIlM0ElMjJodHRwcyUzQSUyRiUyRnd3dy1vcmVpbGx5LWNvbS5wcm94eS5saWIudXdhdGVybG9vLmNhJTJGJTIyJTJDJTIycmVmZXJyaW5nX2RvbWFpbiUyMiUzQSUyMnd3dy1vcmVpbGx5LWNvbS5wcm94eS5saWIudXdhdGVybG9vLmNhJTIyJTdE',
    '_ga_YX510R4NR5': 'GS1.2.1691978225.9.0.1691978225.0.0.0',
    '_ga_PJGZ22CMQ8': 'GS1.2.1688184125.1.0.1688184125.0.0.0',
    'ph_foZTeM1AW8dh5WkaofxTYiInBhS4XzTzRqLs50kVziw_posthog': '%7B%22distinct_id%22%3A%221893df3e34262-0dbe54686b4c498-d505429-264900-1893df3e3434a6%22%2C%22%24device_id%22%3A%221893df3e34262-0dbe54686b4c498-d505429-264900-1893df3e3434a6%22%2C%22%24user_state%22%3A%22anonymous%22%2C%22extension_version%22%3A%221.5.5%22%2C%22%24session_recording_enabled_server_side%22%3Afalse%2C%22%24autocapture_disabled_server_side%22%3Afalse%2C%22%24active_feature_flags%22%3A%5B%5D%2C%22%24enabled_feature_flags%22%3A%7B%22enable-session-recording%22%3Afalse%2C%22sourcing%22%3Afalse%2C%22only-company-edit%22%3Afalse%2C%22job-lists%22%3Afalse%7D%2C%22%24feature_flag_payloads%22%3A%7B%7D%7D',
    '_ga_ZCQJVP62ZW': 'GS1.1.1700169598.12.1.1700170244.0.0.0',
    '_ga_99DQXKGYC7': 'GS1.1.1701746185.9.0.1701746185.0.0.0',
    'cookieControl': 'true',
    'cookieControlPrefs': '[]',
    'PS_DEVICEFEATURES': 'maf:0 width:2048 height:2048 clientWidth:1920 clientHeight:919 pixelratio:1 touch:0 geolocation:1 websockets:1 webworkers:1 datepicker:1 dtpicker:1 timepicker:1 dnd:1 sessionstorage:1 localstorage:1 history:1 canvas:1 svg:1 postmessage:1 hc:0',
    'lcsrftoken': 'kXai6Wp5EybX/YN/+5fjP6KZ6wfaeljZVa93lA4n8J4=',
    'PS_TokenSite': 'https://quest.pecs.uwaterloo.ca/psc/SS/?CSPRPDB-PORTAL-PSJSESSIONID',
    'SignOnDefault': '',
    'ASP.NET_SessionId': '4tbpff2aymwsmvhik1bcb54b',
    '__RequestVerificationToken': 'kNIRVj1G40q_bOFxf8_iuPW4Exjami2gZaJRZX-P_245jOZPVZObKR_YnOBKyL7yxvyhJIyBODWxan9kvZStGtazdQzW4Br7b-Rndwd0_uI1',
    '.AspNet.ApplicationCookie': 'j87N8Ejv8_h39JEJdkL3XOX24bdN_gfzRxy76qxFCYJjvrZh09b8IDbzs93manLWaF6eYDhflmlkpTdC0dBNwQQ4aM2K-oGwd3k93w18FO4MFf-wu9yWcUaDgVJAXK5XXOK__APbLsJLnmEogqBPeirRsxkco_DYgzIgmr-HboSRjM0EFt_cr-ya2hcS6SDGTjpgrILLSra4supTJEUDA0BJT8iCgMRWZMs9pK3tm0Vzl-nPI7J_CI85Bkulsxpyae3GzW0ppGm5-AbYUtAJdkGTzZNqsm2MKbeSfZyG4pUZxFLLRZkdW2clTBUM28GkL5FzD7ClpZWNgn41crx9g77MKkBVfmANGRd3OSACwBG73y5hgOD6HDJhMef8yCWGnSSlE4XB2IU1jVQIfsXmlw',
    'CSPRPDB-PORTAL-PSJSESSIONID': 'Pjc6OJIXMVh5Z-1IjJriae_yorVT5KI0!55783008',
    'X-Oracle-BMC-LBS-Route': '93a22a4663769026ca3c68a1f913303746fff1aca955101351b2a3d0e4fe6d526184d9d15fa976c0754042c58a252899734cad5a651390df361d490f',
    'ExpirePage': 'https://quest.pecs.uwaterloo.ca/psp/SS/',
    'PS_LOGINLIST': 'https://quest.pecs.uwaterloo.ca/SS',
    'PS_TOKENEXPIRE': '24_Jan_2024_06:47:11_GMT',
    'PS_TOKEN': 'pwAAAAQDAgEBAAAAvAIAAAAAAAAsAAAABABTaGRyAk4Abwg4AC4AMQAwABRbHs4xXlgUEQfns/FUDnpCTluV1WcAAAAFAFNkYXRhW3icHcpJCoAwEETRHxWXuYmSxDgtRUTciDiQpUfwgh7ONt3wCop6gCxNlJJ8E+LpgKPlZGFgJZ+EGX0RuBk52NjxDiMzTyFpRUcVNZTSNlEr9tR08v+WD4vvC6w=',
    'PS_LASTSITE': 'https://quest.pecs.uwaterloo.ca/psp/SS/',
    'ps_theme': 'node:SA portal:ACADEMIC theme_id:UWSA_DEFAULT_THEME_FLUID css:UWSA_CLASSIC_TEMPLTE_FLUID css_f:UWSA_BRAND_FLUID_TEMPLATE_860 accessibility:N macroset:UWSA_DEFAULT_MACROSET_860 formfactor:3 piamode:2',
    'psback': '%22%22url%22%3A%22https%3A%2F%2Fquest.pecs.uwaterloo.ca%2Fpsc%2FSS%2FACADEMIC%2FSA%2Fc%2FNUI_FRAMEWORK.PT_AGSTARTPAGE_NUI.GBL%3FCONTEXTIDPARAMS%3DTEMPLATE_ID%253aPTPPNAVCOL%26scname%3DADMN_COURSE_SELECTION0%26PanelCollapsible%3DY%26PTPPB_GROUPLET_ID%3DADMN_SC_PGT_COURSE_SELECTION%26CRefName%3DADMN_NAVCOLL_31%26AJAXTransfer%3DY%22%20%22label%22%3A%22Pre-Enroll%20for%20a%20Future%20Term%22%20%22origin%22%3A%22PIA%22%20%22layout%22%3A%220%22%20%22refurl%22%3A%22https%3A%2F%2Fquest.pecs.uwaterloo.ca%2Fpsc%2FSS%2FACADEMIC%2FSA%22%22',
    '_shibsession_64656661756c7468747470733a2f2f77617272696f722e7577617465726c6f6f2e63612f73686962626f6c657468': '_a1c879b95138d813099b6d6547532529',
}

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0',
    'Accept': '*/*',
    'Accept-Language': 'en-US,en;q=0.8,fr;q=0.5,fr-FR;q=0.3',
    'Accept-Encoding': 'gzip, deflate, br',
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
    'X-Requested-With': 'XMLHttpRequest',
    'Origin': 'https://warrior.uwaterloo.ca',
    'Connection': 'keep-alive',
    'Sec-Fetch-Dest': 'empty',
    'Sec-Fetch-Mode': 'cors',
    'Sec-Fetch-Site': 'same-origin',
    'TE': 'trailers',
}

data = {
  'appointments[0][ID]': 'c21623e3-bfdb-4f9a-aa01-55bf30d257ae',
  'appointments[0][RecurrenceInfo]': '',
  'appointments[0][AppointmentType]': '0',
  'appointments[0][StartDate]': '2024-02-07T22:30:00',
  'appointments[0][EndDate]': '2024-02-08T00:15:00',
  'appointments[0][Location]': 'PAC Small Gym',
  'appointments[0][Subject]': '',
  'appointments[0][AllDay]': 'false',
  'appointments[0][ResourceId]': '',
  'appointments[0][Status]': '0',
  'appointments[0][ProductName]': 'SERVE Volleyball Club',
  'appointments[0][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[0][ProgramDescription]': '',
  'appointments[0][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[0][NumberRegistered]': '0',
  'appointments[0][NumberOnWaitlist]': '0',
  'appointments[0][ClassSize]': '24',
  'appointments[0][PortalURL]': '',
  'appointments[0][InstructorFirstNameLastInitial]': '',
  'appointments[0][IsInstructor]': 'false',
  'appointments[0][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[0][IsRecurring]': 'false',
  'appointments[1][ID]': '1eb7272c-d8b6-4f3e-be86-a95fd1453350',
  'appointments[1][RecurrenceInfo]': '',
  'appointments[1][AppointmentType]': '0',
  'appointments[1][StartDate]': '2024-02-08T21:30:00',
  'appointments[1][EndDate]': '2024-02-09T00:00:00',
  'appointments[1][Location]': 'PAC Small Gym',
  'appointments[1][Subject]': '',
  'appointments[1][AllDay]': 'false',
  'appointments[1][ResourceId]': '',
  'appointments[1][Status]': '0',
  'appointments[1][ProductName]': 'SERVE Volleyball Club',
  'appointments[1][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[1][ProgramDescription]': '',
  'appointments[1][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[1][NumberRegistered]': '0',
  'appointments[1][NumberOnWaitlist]': '0',
  'appointments[1][ClassSize]': '24',
  'appointments[1][PortalURL]': '',
  'appointments[1][InstructorFirstNameLastInitial]': '',
  'appointments[1][IsInstructor]': 'false',
  'appointments[1][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[1][IsRecurring]': 'false',
  'appointments[2][ID]': '15058d5f-4d0e-43f9-a169-7433d48b7381',
  'appointments[2][RecurrenceInfo]': '',
  'appointments[2][AppointmentType]': '0',
  'appointments[2][StartDate]': '2024-02-09T15:01:00',
  'appointments[2][EndDate]': '2024-02-09T17:00:00',
  'appointments[2][Location]': 'CIF Gym 1',
  'appointments[2][Subject]': '',
  'appointments[2][AllDay]': 'false',
  'appointments[2][ResourceId]': '',
  'appointments[2][Status]': '0',
  'appointments[2][ProductName]': 'SERVE Volleyball Club',
  'appointments[2][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[2][ProgramDescription]': '',
  'appointments[2][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[2][NumberRegistered]': '0',
  'appointments[2][NumberOnWaitlist]': '0',
  'appointments[2][ClassSize]': '24',
  'appointments[2][PortalURL]': '',
  'appointments[2][InstructorFirstNameLastInitial]': '',
  'appointments[2][IsInstructor]': 'false',
  'appointments[2][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[2][IsRecurring]': 'false',
  'appointments[3][ID]': '2b4e66a0-2c93-419f-b7ae-e4f907cd51dd',
  'appointments[3][RecurrenceInfo]': '',
  'appointments[3][AppointmentType]': '0',
  'appointments[3][StartDate]': '2024-02-09T15:02:00',
  'appointments[3][EndDate]': '2024-02-09T17:00:00',
  'appointments[3][Location]': 'CIF Gym 2',
  'appointments[3][Subject]': '',
  'appointments[3][AllDay]': 'false',
  'appointments[3][ResourceId]': '',
  'appointments[3][Status]': '0',
  'appointments[3][ProductName]': 'SERVE Volleyball Club',
  'appointments[3][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[3][ProgramDescription]': '',
  'appointments[3][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[3][NumberRegistered]': '0',
  'appointments[3][NumberOnWaitlist]': '0',
  'appointments[3][ClassSize]': '24',
  'appointments[3][PortalURL]': '',
  'appointments[3][InstructorFirstNameLastInitial]': '',
  'appointments[3][IsInstructor]': 'false',
  'appointments[3][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[3][IsRecurring]': 'false',
  'appointments[4][ID]': '37f135d0-6877-4d61-9e35-fc9bd8c19bae',
  'appointments[4][RecurrenceInfo]': '',
  'appointments[4][AppointmentType]': '0',
  'appointments[4][StartDate]': '2024-02-09T17:01:00',
  'appointments[4][EndDate]': '2024-02-09T19:00:00',
  'appointments[4][Location]': 'CIF Gym 1',
  'appointments[4][Subject]': '',
  'appointments[4][AllDay]': 'false',
  'appointments[4][ResourceId]': '',
  'appointments[4][Status]': '0',
  'appointments[4][ProductName]': 'SERVE Volleyball Club',
  'appointments[4][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[4][ProgramDescription]': '',
  'appointments[4][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[4][NumberRegistered]': '0',
  'appointments[4][NumberOnWaitlist]': '0',
  'appointments[4][ClassSize]': '24',
  'appointments[4][PortalURL]': '',
  'appointments[4][InstructorFirstNameLastInitial]': '',
  'appointments[4][IsInstructor]': 'false',
  'appointments[4][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[4][IsRecurring]': 'false',
  'appointments[5][ID]': 'f2861924-0397-4037-9c1f-5f6bd5102b86',
  'appointments[5][RecurrenceInfo]': '',
  'appointments[5][AppointmentType]': '0',
  'appointments[5][StartDate]': '2024-02-09T17:02:00',
  'appointments[5][EndDate]': '2024-02-09T19:00:00',
  'appointments[5][Location]': 'CIF Gym 2',
  'appointments[5][Subject]': '',
  'appointments[5][AllDay]': 'false',
  'appointments[5][ResourceId]': '',
  'appointments[5][Status]': '0',
  'appointments[5][ProductName]': 'SERVE Volleyball Club',
  'appointments[5][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[5][ProgramDescription]': '',
  'appointments[5][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[5][NumberRegistered]': '0',
  'appointments[5][NumberOnWaitlist]': '0',
  'appointments[5][ClassSize]': '24',
  'appointments[5][PortalURL]': '',
  'appointments[5][InstructorFirstNameLastInitial]': '',
  'appointments[5][IsInstructor]': 'false',
  'appointments[5][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[5][IsRecurring]': 'false',
  'appointments[6][ID]': 'f7e8c31a-5876-4e12-9abe-4dff9b57c02f',
  'appointments[6][RecurrenceInfo]': '',
  'appointments[6][AppointmentType]': '0',
  'appointments[6][StartDate]': '2024-02-09T19:01:00',
  'appointments[6][EndDate]': '2024-02-09T21:00:00',
  'appointments[6][Location]': 'CIF Gym 1',
  'appointments[6][Subject]': '',
  'appointments[6][AllDay]': 'false',
  'appointments[6][ResourceId]': '',
  'appointments[6][Status]': '0',
  'appointments[6][ProductName]': 'SERVE Volleyball Club',
  'appointments[6][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[6][ProgramDescription]': '',
  'appointments[6][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[6][NumberRegistered]': '0',
  'appointments[6][NumberOnWaitlist]': '0',
  'appointments[6][ClassSize]': '24',
  'appointments[6][PortalURL]': '',
  'appointments[6][InstructorFirstNameLastInitial]': '',
  'appointments[6][IsInstructor]': 'false',
  'appointments[6][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[6][IsRecurring]': 'false',
  'appointments[7][ID]': '59440388-2326-4adc-9aa6-6e6ba7b5f65d',
  'appointments[7][RecurrenceInfo]': '',
  'appointments[7][AppointmentType]': '0',
  'appointments[7][StartDate]': '2024-02-09T19:02:00',
  'appointments[7][EndDate]': '2024-02-09T21:00:00',
  'appointments[7][Location]': 'CIF Gym 2',
  'appointments[7][Subject]': '',
  'appointments[7][AllDay]': 'false',
  'appointments[7][ResourceId]': '',
  'appointments[7][Status]': '0',
  'appointments[7][ProductName]': 'SERVE Volleyball Club',
  'appointments[7][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[7][ProgramDescription]': '',
  'appointments[7][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[7][NumberRegistered]': '0',
  'appointments[7][NumberOnWaitlist]': '0',
  'appointments[7][ClassSize]': '24',
  'appointments[7][PortalURL]': '',
  'appointments[7][InstructorFirstNameLastInitial]': '',
  'appointments[7][IsInstructor]': 'false',
  'appointments[7][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[7][IsRecurring]': 'false',
  'appointments[8][ID]': '1eb7272c-d8b6-4f3e-be86-a95fd1453350',
  'appointments[8][RecurrenceInfo]': '',
  'appointments[8][AppointmentType]': '0',
  'appointments[8][StartDate]': '2024-02-09T21:30:00',
  'appointments[8][EndDate]': '2024-02-10T00:00:00',
  'appointments[8][Location]': 'PAC Small Gym',
  'appointments[8][Subject]': '',
  'appointments[8][AllDay]': 'false',
  'appointments[8][ResourceId]': '',
  'appointments[8][Status]': '0',
  'appointments[8][ProductName]': 'SERVE Volleyball Club',
  'appointments[8][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[8][ProgramDescription]': '',
  'appointments[8][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[8][NumberRegistered]': '0',
  'appointments[8][NumberOnWaitlist]': '0',
  'appointments[8][ClassSize]': '24',
  'appointments[8][PortalURL]': '',
  'appointments[8][InstructorFirstNameLastInitial]': '',
  'appointments[8][IsInstructor]': 'false',
  'appointments[8][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[8][IsRecurring]': 'false',
  'appointments[9][ID]': '46d677a7-5fa7-4d66-a265-b3b337a5b71f',
  'appointments[9][RecurrenceInfo]': '',
  'appointments[9][AppointmentType]': '0',
  'appointments[9][StartDate]': '2024-02-11T09:00:00',
  'appointments[9][EndDate]': '2024-02-11T11:30:00',
  'appointments[9][Location]': 'PAC Small Gym',
  'appointments[9][Subject]': '',
  'appointments[9][AllDay]': 'false',
  'appointments[9][ResourceId]': '',
  'appointments[9][Status]': '0',
  'appointments[9][ProductName]': 'SERVE Volleyball Club',
  'appointments[9][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[9][ProgramDescription]': '',
  'appointments[9][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[9][NumberRegistered]': '0',
  'appointments[9][NumberOnWaitlist]': '0',
  'appointments[9][ClassSize]': '24',
  'appointments[9][PortalURL]': '',
  'appointments[9][InstructorFirstNameLastInitial]': '',
  'appointments[9][IsInstructor]': 'false',
  'appointments[9][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[9][IsRecurring]': 'false',
  'appointments[10][ID]': '4f418d4d-0c56-45e8-9ac2-d52a17e878fa',
  'appointments[10][RecurrenceInfo]': '',
  'appointments[10][AppointmentType]': '0',
  'appointments[10][StartDate]': '2024-02-11T11:30:00',
  'appointments[10][EndDate]': '2024-02-11T14:00:00',
  'appointments[10][Location]': 'PAC Small Gym',
  'appointments[10][Subject]': '',
  'appointments[10][AllDay]': 'false',
  'appointments[10][ResourceId]': '',
  'appointments[10][Status]': '0',
  'appointments[10][ProductName]': 'SERVE Volleyball Club',
  'appointments[10][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[10][ProgramDescription]': '',
  'appointments[10][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[10][NumberRegistered]': '0',
  'appointments[10][NumberOnWaitlist]': '0',
  'appointments[10][ClassSize]': '24',
  'appointments[10][PortalURL]': '',
  'appointments[10][InstructorFirstNameLastInitial]': '',
  'appointments[10][IsInstructor]': 'false',
  'appointments[10][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[10][IsRecurring]': 'false',
  'programID': '2882ad00-6e10-4b25-ac28-238a716ab8c5',
  'year': '2024',
  'month': '2',
  'day': '9'
}


data2 = {
  'appointments[0][ID]': '46d677a7-5fa7-4d66-a265-b3b337a5b71f',
  'appointments[0][RecurrenceInfo]': '',
  'appointments[0][AppointmentType]': '0',
  'appointments[0][StartDate]': '2024-02-04T09:00:00',
  'appointments[0][EndDate]': '2024-02-04T11:30:00',
  'appointments[0][Location]': 'PAC Small Gym',
  'appointments[0][Subject]': '',
  'appointments[0][AllDay]': 'false',
  'appointments[0][ResourceId]': '',
  'appointments[0][Status]': '0',
  'appointments[0][ProductName]': 'SERVE Volleyball Club',
  'appointments[0][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[0][ProgramDescription]': '',
  'appointments[0][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[0][NumberRegistered]': '0',
  'appointments[0][NumberOnWaitlist]': '0',
  'appointments[0][ClassSize]': '24',
  'appointments[0][PortalURL]': '',
  'appointments[0][InstructorFirstNameLastInitial]': '',
  'appointments[0][IsInstructor]': 'false',
  'appointments[0][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[0][IsRecurring]': 'false',
  'appointments[1][ID]': '4f418d4d-0c56-45e8-9ac2-d52a17e878fa',
  'appointments[1][RecurrenceInfo]': '',
  'appointments[1][AppointmentType]': '0',
  'appointments[1][StartDate]': '2024-02-04T11:30:00',
  'appointments[1][EndDate]': '2024-02-04T14:00:00',
  'appointments[1][Location]': 'PAC Small Gym',
  'appointments[1][Subject]': '',
  'appointments[1][AllDay]': 'false',
  'appointments[1][ResourceId]': '',
  'appointments[1][Status]': '0',
  'appointments[1][ProductName]': 'SERVE Volleyball Club',
  'appointments[1][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[1][ProgramDescription]': '',
  'appointments[1][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[1][NumberRegistered]': '0',
  'appointments[1][NumberOnWaitlist]': '0',
  'appointments[1][ClassSize]': '24',
  'appointments[1][PortalURL]': '',
  'appointments[1][InstructorFirstNameLastInitial]': '',
  'appointments[1][IsInstructor]': 'false',
  'appointments[1][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[1][IsRecurring]': 'false',
  'appointments[2][ID]': 'c21623e3-bfdb-4f9a-aa01-55bf30d257ae',
  'appointments[2][RecurrenceInfo]': '',
  'appointments[2][AppointmentType]': '0',
  'appointments[2][StartDate]': '2024-02-07T22:30:00',
  'appointments[2][EndDate]': '2024-02-08T00:15:00',
  'appointments[2][Location]': 'PAC Small Gym',
  'appointments[2][Subject]': '',
  'appointments[2][AllDay]': 'false',
  'appointments[2][ResourceId]': '',
  'appointments[2][Status]': '0',
  'appointments[2][ProductName]': 'SERVE Volleyball Club',
  'appointments[2][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[2][ProgramDescription]': '',
  'appointments[2][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[2][NumberRegistered]': '0',
  'appointments[2][NumberOnWaitlist]': '0',
  'appointments[2][ClassSize]': '24',
  'appointments[2][PortalURL]': '',
  'appointments[2][InstructorFirstNameLastInitial]': '',
  'appointments[2][IsInstructor]': 'false',
  'appointments[2][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[2][IsRecurring]': 'false',
  'appointments[3][ID]': '1eb7272c-d8b6-4f3e-be86-a95fd1453350',
  'appointments[3][RecurrenceInfo]': '',
  'appointments[3][AppointmentType]': '0',
  'appointments[3][StartDate]': '2024-02-08T21:30:00',
  'appointments[3][EndDate]': '2024-02-09T00:00:00',
  'appointments[3][Location]': 'PAC Small Gym',
  'appointments[3][Subject]': '',
  'appointments[3][AllDay]': 'false',
  'appointments[3][ResourceId]': '',
  'appointments[3][Status]': '0',
  'appointments[3][ProductName]': 'SERVE Volleyball Club',
  'appointments[3][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[3][ProgramDescription]': '',
  'appointments[3][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[3][NumberRegistered]': '0',
  'appointments[3][NumberOnWaitlist]': '0',
  'appointments[3][ClassSize]': '24',
  'appointments[3][PortalURL]': '',
  'appointments[3][InstructorFirstNameLastInitial]': '',
  'appointments[3][IsInstructor]': 'false',
  'appointments[3][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[3][IsRecurring]': 'false',
  'appointments[4][ID]': '1eb7272c-d8b6-4f3e-be86-a95fd1453350',
  'appointments[4][RecurrenceInfo]': '',
  'appointments[4][AppointmentType]': '0',
  'appointments[4][StartDate]': '2024-02-09T21:30:00',
  'appointments[4][EndDate]': '2024-02-10T00:00:00',
  'appointments[4][Location]': 'PAC Small Gym',
  'appointments[4][Subject]': '',
  'appointments[4][AllDay]': 'false',
  'appointments[4][ResourceId]': '',
  'appointments[4][Status]': '0',
  'appointments[4][ProductName]': 'SERVE Volleyball Club',
  'appointments[4][ProductId]': '00000000-0000-0000-0000-000000000000',
  'appointments[4][ProgramDescription]': '',
  'appointments[4][ProgramInstanceId]': '00000000-0000-0000-0000-000000000000',
  'appointments[4][NumberRegistered]': '0',
  'appointments[4][NumberOnWaitlist]': '0',
  'appointments[4][ClassSize]': '24',
  'appointments[4][PortalURL]': '',
  'appointments[4][InstructorFirstNameLastInitial]': '',
  'appointments[4][IsInstructor]': 'false',
  'appointments[4][InstructorId]': '00000000-0000-0000-0000-000000000000',
  'appointments[4][IsRecurring]': 'false',
  'programID': '2882ad00-6e10-4b25-ac28-238a716ab8c5',
  'year': '2024',
  'month': '2',
  'day': '4'
}


specified_time = "3:01 PM - 5:00 PM"
specified_time2 = "9:00 AM - 11:30 AM"



times = [specified_time]
data = [data]
COOLDOWN = 15 # seconds


# Set the URL of the page you want to scrape
url = 'https://warrior.uwaterloo.ca/program/GetProgramDetails?courseId=2882ad00-6e10-4b25-ac28-238a716ab8c5'

# Set your email credentials

last_email_time = datetime.now() - timedelta(hours=1)



def send_email(last_email_time, title):
    if datetime.now() - last_email_time >= timedelta(minutes=15):
        for to in to_addr:
            msg = MIMEMultipart()
            msg['From'] = from_addr
            msg['To'] = to
            msg['Subject'] = title
            body = 'Spots are available now!\n'+url
            msg.attach(MIMEText(body, 'plain'))
            server = smtplib.SMTP('smtp-mail.outlook.com', 587)
            server.starttls()
            server.login(from_addr, password)
            text = msg.as_string()
            server.sendmail(from_addr, to, text)
            server.quit()


# send_email(last_email_time, "test")

while True:

    for i in range(len(times)):
        response = requests.post('https://warrior.uwaterloo.ca/Program/FilterProgramInstances', headers=headers, cookies=cookies, data=data[i])
        soup = BeautifulSoup(response.text, 'html.parser')
        print(soup)
        for program_instance in soup.find_all('div', class_='program-instance-card'):
            # Get the instance time
            instance_time = program_instance.find('span', class_='instance-time-header').text.strip()

            # Get the instance date

            # Check if the instance matches the specified time and date
            if times[i] in instance_time:
                # Check if there are spots left
                spots_tag = program_instance.find('div', class_='spots-tag')
                if spots_tag:
                    spots_left = spots_tag.find('p', class_='card-text').text.strip()
                    date_object = datetime(2024, int(data[i]['month']), int(data[i]['day'])).strftime("%A, %b %d")
                    if spots_left != "No Spots Left":
                        print(f"Spots left for {times[i]} , {date_object}")
                        # Send an email
                        send_email(last_email_time, f"Spots left for {times[i]} , {date_object}: {spots_left}")
                        last_email_time = datetime.now()
                    else:
                        print('RIP no spots available for ' + f"{times[i]} {date_object}")
                        print("current time: ",
                            (datetime.now(timezone.utc) - timedelta(hours=5)).strftime("%y-%m-%d %H:%M:%S"))


    time.sleep(COOLDOWN)
